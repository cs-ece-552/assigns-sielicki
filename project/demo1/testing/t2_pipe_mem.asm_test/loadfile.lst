          // CS552 2008 student tests
          // Original Authors: Matt Sinclair, Amy Zou, Ju shin Lee
          
          // Author: Matt Sinclair
          // CS/ECE 552 Spring '08
          // Demo III Test File
          //
          // Filename: pipe_mem.asm
          // Pipeline dependencies test
          //
          // This was intended to serve as a test of load and other instructions having
          // dependencies between them.  It serves more as a dependency between stages test
          // though.  loopTest.asm is a better test of load and other instructions'
          // inter-dependencies.
          
0000 201a j	.realStart	// also a flush
0002 c0ff LBI	r0, -1
0004 c1ff LBI	r1, -1
0006 c2ff LBI	r2, -1
0008 c3ff LBI	r3, -1
000a c4ff LBI	r4, -1
000c c5ff LBI	r5, -1
000e c6ff LBI	r6, -1
0010 c7ff LBI	r7, -1	
0012 0000 halt
0014 0000 halt
0016 0000 halt
0018 0000 halt
001a 0000 halt
          	
          // initialize all registers to 0
001c      .realStart:
001c c000 LBI	r0, 0
001e c100 LBI	r1, 0
0020 c200 LBI	r2, 0
0022 c300 LBI	r3, 0
0024 c400 LBI	r4, 0
0026 c500 LBI	r5, 0
0028 c600 LBI	r6, 0
002a c700 LBI	r7, 0
          
          // some basic instructions to get us going	
002c 4926 addi	r1, r1, 6	
002e 0800 nop
0030 4a44 addi	r2, r2, 4	
0032 481f addi	r0, r0, -1	
          		
          // forward from ex_mem (dependency)
0034 d02d sll	r3, r0, r1
          	
          // forward from mem_wb (dependency)
0036 f610 sle	r4, r6, r0
          	
          // bypass register file (dependency)
0038 d816 xor	r5, r0, r0	
          
          // forward from ex_mem
003a 45c1 subi	r6, r5, 1
          	
          // forward from mem_wb
003c d546 ror	r1, r5, r2
          	
          // bypass register file
003e cd0c btr	r3, r5
          	
          // forward from ex_mem
0040 fb00 sco	r0, r3, r0
          	
          // forward from mem_wb
0042 f384 sle	r1, r3, r4
          		
          // bypass register file
0044 4e42 addi	r2, r6, 2
          
          // stall
0046 481f addi	r0, r0, -1
0048 809f st	r4, r0, -1	// these were unaligned and should cause an error (fixed 5/3)
004a 883f ld	r1, r0, -1	
          			// should stall
004c d9d6 xor	r5, r1, r6	
          	
          // flush (branch)
004e 7d08 bgez	r5, .goHere
0050 0000 halt			// shouldn't execute
0052 0000 halt
0054 0000 halt
0056 c7fe lbi	r7, -2
          
0058      .goHere:
0058 95ff slbi	r5, 0xFF	// r5 = 0x0100 | 0x00FF = 0x01FF
005a 0800 nop
005c 0000 halt			// end mattTest.asm
          			// Expected values:
          			// r0 = 0xFFFF
          			// r1 = 0x0020
          			// r2 = 0x0004
          			// r3 = 0xFFC0
          			// r4 = 0x0000
          			// r5 = 0x20FF
          			// r6 = 0x0000
          			// r7 = 0x0000
